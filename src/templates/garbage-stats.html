{% extends 'base.html' %}

{% block stats %}
<input type="text" class="block bg-transparent hover:bg-slate-200 focus:bg-transparent
    text-3xl font-bold rounded-md focus-visible:ring-2 focus-visible:ring-slate-300
    focus-visible:rounded focus-visible:outline-none px-2 py-1" value="{{target.address}}" placeholder="Address"
    onfocusout="saveContent(this, 'address')" data-prev-value="{{target.address}}"
    onkeyup="if (event.keyCode == 13) this.blur();">

<input type="text" class="block bg-transparent hover:bg-slate-200 focus:bg-transparent
    text-xl font-semibold rounded-md focus-visible:ring-2 focus-visible:ring-slate-300
    focus-visible:rounded focus-visible:outline-none px-2 py-1" value="{{target.location}}" placeholder="Location"
    onfocusout="saveContent(this, 'location')" data-prev-value="{{target.location}}"
    onkeyup="if (event.keyCode == 13) this.blur();">

<div class="flex justify-center items-center flex-wrap gap-x-6 gap-y-10 w-auto mt-16">
    <div id="graph" class="flex flex-grow justify-center items-center"></div>
    <div class="flex flex-col justify-center text-center w-[400px]
    h-[300px] bg-slate-800 shadow rounded-xl overflow-hidden">
        {% if target.cam_connected %}
        <img id="photo" src="{{ url_for('static', filename=target.img_path) }}"
            alt="Garbage bin at {{ target.address }}, {{ target.location }}">
        {% else %}
        <div class="text-slate-50 text-xl font-bold">No camera connected</div>
        {% endif %}
    </div>
</div>

<script>
    function saveContent(input, field) {
        if (input.value === '') {
            input.value = input.dataset.prevValue;
        } else {
            input.dataset.prevValue = input.value;
            fetch('/b/{{target.id}}', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ field, value: input.value })
            });
        };

    }

    // Ignore the linting errors - this is Jinja syntax
    const time_data = {{ litter_data[0] }};
    const litter_data = {{ litter_data[1] }};
    const data = time_data.map((e, i) => ({ date: e, litterCount: litter_data[i] }));
</script>
<script src="{{ url_for('static', filename='d3.v6.min.js') }}"></script>
<script src="{{ url_for('static', filename='garbage-stats.js') }}"></script>
{% endblock %}